meta:
- desc: install ceph/mimic latest
tasks:
- install:
    branch: mimic
    exclude_packages:
      - librados3
      - ceph-mgr-dashboard
      - ceph-mgr-diskprediction-local
      - ceph-mgr-diskprediction-cloud
      - ceph-mgr-rook
      - ceph-mgr-ssh
    extra_packages: ['librados2']
- print: "**** done install mimic"
- ceph:
    conf:
      global:
        bluestore_warn_on_legacy_statfs: false
- exec:
    osd.0:
      - ceph osd require-osd-release mimic
      - ceph osd set-require-min-compat-client mimic
- print: "**** done ceph"
overrides:
  ceph:
    conf:
      mon:
        mon warn on osd down out interval zero: false
      # speed up recovery and deletion for omap generated by ragweed tests w/more memory and cpu for rocksdb
      osd:
        osd memory target: 6G
        rocksdb cache size: 2G
        bluestore rocksdb options: max_background_jobs=10,compression=kNoCompression,max_write_buffer_number=4,min_write_buffer_number_to_merge=1,recycle_log_file_num=4,write_buffer_size=268435456,writable_file_max_buffer_size=0,compaction_readahead_size=2097152
